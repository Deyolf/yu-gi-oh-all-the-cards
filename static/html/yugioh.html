<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carte Yu-Gi-Oh!</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .modal-content {
      background-color: #343a40; /* Colore scuro per il contenuto della modale */
      color: white; /* Colore del testo bianco */
    }

    .modal-body {
      display: flex; /* Utilizza Flexbox per affiancare l'immagine e le informazioni */
      align-items: center; /* Allinea verticalmente */
    }

    .card-img-top {
      cursor: pointer;
      width: 100%; /* Imposta la larghezza dell'immagine */
      height: auto; /* Mantiene l'aspetto dell'immagine */
      max-width: 300px; /* Limita la larghezza massima dell'immagine */
      margin-right: 20px; /* Spazio tra l'immagine e le informazioni */
    }

    .suggestions {
      position: absolute;
      z-index: 1000;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid #ccc;
      display: none;
      color: white;
      margin-top: 35px;
    }

    .suggestion-item {
      padding: 10px;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .blurred {
      filter: blur(5px); /* Aggiungi l'effetto blur */
      transition: filter 0.3s ease; /* Transizione per un effetto più fluido */
    }

    /* Styling per le carte */
    .card {
      background-color: #6c757d; /* Colore di sfondo della carta */
      border: none; /* Rimuovi il bordo della carta */
    }

    .card-title {
      color: #f8f9fa; /* Colore del titolo della carta */
    }
  </style>
</head>

<body class="bg-dark text-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-black">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" onclick="resetSearch()">Carte Yu-Gi-Oh!</a>
      <form class="d-flex position-relative" id="searchForm" onsubmit="searchCard(event)">
        <input class="form-control me-2" type="search" placeholder="Cerca carta" aria-label="Search" id="searchInput" oninput="showSuggestions()">
        <button class="btn btn-outline-light" type="submit">Cerca</button>
        <div id="suggestions" class="suggestions"></div>
      </form>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href='/'>Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Deck</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container text-center mt-4">
    <div class="row mb-3">
      <div class="col-md-4 text-start">
        <div class="form-group">
          <label for="cardsPerPage">Carte per pagina:</label>
          <select class="form-control" id="cardsPerPage" onchange="updateCardsPerPage()">
            <option value="12">12</option>
            <option value="24" selected>24</option>
            <option value="36">36</option>
            <option value="48">48</option>
          </select>
        </div>
      </div>
      <div class="col-md-4 text-start">
        <div class="form-group">
          <label for="cardType">Tipo di Carta:</label>
          <select class="form-control" id="cardType" onchange="filterCards()">
            <option value="">Tutti</option>
            <option value="Monster">Mostri</option>
            <option value="Spell">Magie</option>
            <option value="Trap">Trappole</option>
            <option value="Normal">Mostri Normali</option>
            <option value="Effect">Mostri con Effetto</option>
            <option value="Fusion">Mostri Fusione</option>
            <option value="Ritual">Mostri Rituale</option>
            <option value="Synchro">Mostri Synchro</option>
            <option value="XYZ">Mostri XYZ</option>
            <option value="Link">Mostri Link</option>
          </select>
        </div>
      </div>
    </div>
    <div id="cards-container" class="row"></div>
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-center mt-4" id="pagination"></ul>
    </nav>
  </div>

  <!-- Modale singolo per mostrare dettagli e immagine -->
  <div class="modal fade" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
          <img id="modalImage" class="img-fluid card-img-top" alt="Card Image">
          <div>
            <h3 id="modalCardName"></h3>
            <p id="modalCardDescription"></p>
            <p><strong>Tipo:</strong> <span id="modalCardType"></span></p>
            <p><strong>Attacco:</strong> <span id="modalCardAttack"></span></p>
            <p><strong>Difesa:</strong> <span id="modalCardDefense"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let cards = [];
    let currentPage = 1;
    let cardsPerPage = 24;
    let filteredCards = [];

    fetch('https://db.ygoprodeck.com/api/v7/cardinfo.php')
      .then(response => response.json())
      .then(data => {
        cards = data.data;
        filteredCards = cards; // Inizialmente mostra tutte le carte
        renderCards();
        updatePagination();
      })
      .catch(error => console.error('Errore durante il recupero delle carte:', error));

    function renderCards() {
      const cardsContainer = document.getElementById('cards-container');
      cardsContainer.innerHTML = '';

      const start = (currentPage - 1) * cardsPerPage;
      const end = start + cardsPerPage;
      const cardsToDisplay = filteredCards.slice(start, end);

      cardsToDisplay.forEach(card => {
        const cardElement = document.createElement('div');
        cardElement.classList.add('col-lg-2', 'col-md-4', 'col-sm-6', 'mb-4');
        cardElement.innerHTML =
          `<div class="card" style="width: 100%;">
            <img src="${card.card_images[0].image_url}" class="card-img-top" alt="${card.name}" onclick="mostraDettagliCarta(${JSON.stringify(card).replace(/"/g, '&quot;')})" data-bs-toggle="modal" data-bs-target="#cardModal">
            <div class="card-body">
              <h5 class="card-title">${card.name}</h5>
            </div>
          </div>`;
        cardsContainer.appendChild(cardElement);
      });
    }

    function updatePagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
      const displayedPages = getDisplayedPages(currentPage, totalPages);

      const prevItem = document.createElement('li');
      prevItem.className = 'page-item' + (currentPage === 1 ? ' disabled' : '');
      prevItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">&laquo; Precedente</a>`;
      pagination.appendChild(prevItem);

      displayedPages.forEach(page => {
        const pageItem = document.createElement('li');
        pageItem.className = 'page-item' + (currentPage === page ? ' active' : '');
        pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${page})">${page}</a>`;
        pagination.appendChild(pageItem);
      });

      const nextItem = document.createElement('li');
      nextItem.className = 'page-item' + (currentPage === totalPages ? ' disabled' : '');
      nextItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Successivo &raquo;</a>`;
      pagination.appendChild(nextItem);
    }

    function getDisplayedPages(currentPage, totalPages) {
      const displayedPages = [];
      const range = 2; // Numero di pagine da visualizzare

      for (let i = Math.max(1, currentPage - range); i <= Math.min(totalPages, currentPage + range); i++) {
        displayedPages.push(i);
      }

      // Assicurati di includere la prima e l'ultima pagina se non già presenti
      if (!displayedPages.includes(1)) {
        displayedPages.unshift(1);
      }
      if (!displayedPages.includes(totalPages) && totalPages > 1) {
        displayedPages.push(totalPages);
      }

      return displayedPages;
    }

    function changePage(page) {
      const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
      if (page < 1 || page > totalPages) return;
      currentPage = page;
      renderCards();
      updatePagination();
    }

    function updateCardsPerPage() {
      cardsPerPage = parseInt(document.getElementById('cardsPerPage').value);
      currentPage = 1; // Reset a pagina 1 quando cambia il numero di carte per pagina
      renderCards();
      updatePagination();
    }

    function filterCards() {
      const selectedType = document.getElementById('cardType').value;

      if (selectedType) {
        filteredCards = cards.filter(card => card.type.includes(selectedType));
      } else {
        filteredCards = cards; // Mostra tutte le carte se non c'è filtro
      }

      currentPage = 1; // Reset a pagina 1 quando cambia il filtro
      renderCards();
      updatePagination();
    }

    function searchCard(event) {
      event.preventDefault();
      const query = document.getElementById('searchInput').value.toLowerCase();

      if (query.trim() === '') {
        resetSearch();
        return;
      }

      filteredCards = filteredCards.filter(card => card.name.toLowerCase().includes(query));

      if (filteredCards.length > 0) {
        currentPage = 1;
        renderCards();
        updatePagination();
      } else {
        alert('Nessuna carta trovata.');
      }
      document.getElementById('suggestions').style.display = 'none';
    }

    function resetSearch() {
      document.getElementById('searchInput').value = '';
      filteredCards = cards; // Ripristina tutte le carte
      currentPage = 1; // Reset a pagina 1
      renderCards();
      updatePagination();
      document.getElementById('suggestions').style.display = 'none';
    }

    function mostraDettagliCarta(card) {
      // Mostra il modal con i dettagli della carta
      document.getElementById('modalCardName').innerText = card.name;
      document.getElementById('modalCardDescription').innerText = card.desc;
      document.getElementById('modalCardType').innerText = card.type;
      document.getElementById('modalCardAttack').innerText = card.atk || 'N/A';
      document.getElementById('modalCardDefense').innerText = card.def || 'N/A';

      // Mostra l'immagine nel modal
      document.getElementById('modalImage').src = card.card_images[0].image_url;

      // Mostra il modal
      const cardModal = new bootstrap.Modal(document.getElementById('cardModal'));
      cardModal.show();
    }

    function showSuggestions() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const suggestionsContainer = document.getElementById('suggestions');
      suggestionsContainer.innerHTML = '';

      if (query.length > 0) {
        const filteredCardsSuggestions = cards.filter(card => card.name.toLowerCase().includes(query));

        filteredCardsSuggestions.slice(0, 8).forEach(card => {
          const suggestionItem = document.createElement('div');
          suggestionItem.className = 'suggestion-item';
          suggestionItem.textContent = card.name;
          suggestionItem.onclick = () => {
            document.getElementById('searchInput').value = card.name;
            mostraDettagliCarta(card);
            suggestionsContainer.style.display = 'none';
          };
          suggestionsContainer.appendChild(suggestionItem);
        });

        suggestionsContainer.style.display = (filteredCardsSuggestions.length > 0) ? 'block' : 'none';
      } else {
        suggestionsContainer.style.display = 'none';
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
